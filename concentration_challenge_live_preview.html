<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Concentration Challenge</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0f172a; --bg2:#1e293b; --accent:#6366f1; --accent2:#22d3ee;
    --card:rgba(255,255,255,.08); --border:rgba(255,255,255,.15);
    --text:#e5e7eb; --muted:#a1a1aa; --cell-blue:#3b82f6; --cell-green:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
       color:var(--text);background:linear-gradient(120deg,var(--bg1),var(--bg2));
       background-size:200% 200%;animation:bgShift 18s ease infinite;}
  @keyframes bgShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  .container{max-width:1100px;margin:0 auto;padding:20px}
  h1{font-weight:800;margin:8px 0 16px}
  .glass{background:var(--card);border:1px solid var(--border);border-radius:16px;
         box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.05);
         backdrop-filter:blur(10px)}
  #topbar{position:sticky;top:0;z-index:10;display:flex;gap:16px;flex-wrap:wrap;align-items:center;justify-content:center;
          padding:12px 16px;margin-bottom:16px;background:rgba(15,23,42,.6)}
  #scoreBoard{font-size:1rem;padding:6px 10px;border-radius:10px;background:rgba(255,255,255,.06);border:1px solid var(--border)}
  input,select{padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text)}
  #timer{font-weight:700;padding:6px 10px;border-radius:999px;min-width:160px;text-align:center;
         background:linear-gradient(90deg,var(--accent),var(--accent2));color:#0b1020}
  button{padding:10px 16px;border-radius:12px;border:1px solid var(--border);
         background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.06));color:var(--text);
         font-weight:600;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.25);transition:transform .06s,box-shadow .2s}
  button:hover{box-shadow:0 12px 26px rgba(0,0,0,.35)}
  button:active{transform:translateY(1px) scale(.98)}
  .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#081226;border:none}
  .panels{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;align-items:flex-start}
  .panel{padding:14px}
  .title{margin:8px 0 12px;font-weight:700}
  .grid,.resultGrid{display:grid;grid-template-columns:repeat(10,32px);grid-template-rows:repeat(10,32px);gap:0;
                    border-radius:12px;overflow:hidden;border:1px solid var(--border);
                    box-shadow:inset 0 1px 0 rgba(255,255,255,.06),0 8px 18px rgba(0,0,0,.25)}
  .cell{width:32px;height:32px;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);cursor:pointer;
        transition:background-color .15s,box-shadow .15s}
  .grid .cell:hover{box-shadow:inset 0 0 0 2px rgba(255,255,255,.15)}
  .blue{background:linear-gradient(180deg,var(--cell-blue),#1e3a8a)}
  .green{background:linear-gradient(180deg,var(--cell-green),#065f46)}
  .white{background:rgba(255,255,255,.02)}
  #quiz,#results,#finish,#billboard{margin-top:16px}
  #quizTimer{font-weight:700;color:var(--muted)}
  table{width:100%;max-width:900px}
  thead th{position:sticky;top:0;background:rgba(255,255,255,.08);border-bottom:1px solid var(--border);padding:10px}
  tbody td{padding:10px;border-bottom:1px solid var(--border)}
  tbody tr:nth-child(odd){background:rgba(255,255,255,.03)}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700}
  .pill.bad{background:rgba(239,68,68,.2);color:#fecaca;border:1px solid rgba(239,68,68,.35)}
  /* Roulette */
  #roulette{display:none;text-align:center}
  .roulette-wrap{position:relative;width:260px;height:260px;margin:0 auto}
  #wheel{width:100%;height:100%;border-radius:50%;border:6px solid rgba(255,255,255,.2);
         background:conic-gradient(#22c55e 0 90deg,#f59e0b 90deg 180deg,#ef4444 180deg 270deg,#3b82f6 270deg 360deg);
         display:grid;place-items:center;transition:transform 5.5s cubic-bezier(.06,.9,.08,1);
         box-shadow:inset 0 2px 8px rgba(0,0,0,.4),0 10px 30px rgba(0,0,0,.35)}
  .wheel-labels{position:absolute;inset:0;pointer-events:none}
  .wheel-labels span{position:absolute;left:50%;top:50%;transform-origin:0 0;font-weight:800;text-shadow:0 2px 6px rgba(0,0,0,.5)}
  .l0{transform:rotate(45deg) translate(60px) rotate(-45deg)}
  .l1{transform:rotate(135deg) translate(60px) rotate(-135deg)}
  .l2{transform:rotate(225deg) translate(60px) rotate(-225deg)}
  .l5{transform:rotate(315deg) translate(60px) rotate(-315deg)}
  #pointer{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);width:0;height:0;
           border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #fff;
           filter:drop-shadow(0 3px 6px rgba(0,0,0,.35));z-index:2}
  .headerRow{display:flex;align-items:center;justify-content:space-between;gap:12px}
  #level{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#081226;border:none;font-weight:700;outline:none}
</style>
</head>
<body>
<div class="container">
  <div class="headerRow"><h1>Concentration Challenge</h1><button id="returnBtn" class="btn-primary" style="display:none">Return</button></div>

  <div id="topbar" class="glass">
    <div><label>Player: <input id="playerName" type="text" placeholder="Your name"></label></div>
    <div id="scoreBoard">Score: 0 / 10 &nbsp;|&nbsp; Wrong: 0 &nbsp;|&nbsp; Coins: 0</div>
    <div>
      <label for="level">Level:</label>
      <select id="level">
        <option value="0">Level 0 (5-10 tiles)</option>
        <option value="1">Level 1 (10-15 tiles)</option>
        <option value="2">Level 2 (15-20 tiles)</option>
        <option value="3">Level 3 (20-25 tiles)</option>
        <option value="4">Level 4 (25-30 tiles)</option>
        <option value="5">Level 5 (30-35 tiles)</option>
        <option value="6">Level 6 (35-40 tiles)</option>
      </select>
      <span id="levelLock" class="muted" style="display:none">(locked during game)</span>
    </div>
    <div id="timer"></div>
    <div style="display:flex;gap:8px">
      <button id="startBtn" class="btn-primary">Start</button>
      <button id="submitBtn" style="display:none">Submit</button>
      
    </div>
  </div>

  <div class="panels">
    <div id="grid" class="glass panel grid"></div>

    <div id="quiz" class="glass panel" style="display:none;min-width:360px">
      <h3 class="title">Quick Check</h3>
      <div id="quizQ" style="margin-bottom:6px;font-size:1.25rem;font-weight:700"></div>
      <div style="display:flex;gap:8px;justify-content:center;align-items:center">
        <input id="quizInput" type="number" inputmode="numeric" placeholder="Answer">
        <button id="quizBtn" class="btn-primary">Check</button>
      </div>
      <div id="quizMsg" class="muted" style="margin-top:6px"></div>
      <div id="quizTimer" class="muted"></div>
    </div>

    <div id="recallGrid" class="glass panel grid" style="display:none"></div>
  </div>

  <div id="results" class="glass panel" style="display:none">
    <div class="panels">
      <div class="gridContainer">
        <h3 class="title">Your Selection</h3>
        <div id="userGrid" class="resultGrid"></div>
      </div>
      <div class="gridContainer">
        <h3 class="title">Correct Pattern</h3>
        <div id="answerGrid" class="resultGrid"></div>
      </div>
    </div>

    <div id="roulette" class="panel">
      <h3 class="title">Roulette Reward</h3>
      <div class="roulette-wrap">
        <div id="pointer"></div>
        <div id="wheel"><div class="wheel-labels">
          <span class="l0">0</span><span class="l1">1</span><span class="l2">2</span><span class="l5">5</span>
        </div></div>
      </div>
      <div id="rouletteResult" class="muted"></div>
      <button id="spinBtn" class="btn-primary">Spin</button>
    </div>

    <div id="exerciseRecall" style="display:none;margin-top:10px;text-align:center">
      <p id="exerciseRecallText"><span class="pill bad">Break</span> Do 10 squats before continuing. Then click I am done.</p>
      <button id="exerciseRecallDoneBtn">I am done</button>
    </div>

    <div style="width:100%;margin-top:10px;text-align:center">
      <button id="nextBtn" class="btn-primary">Next Round</button>
    </div>
  </div>

  <div id="finish" class="glass panel" style="display:none;margin-top:20px;text-align:center">
    <h2>Finished: 10 Correct Rounds!</h2>
    <p id="finalTimeText"></p>
    <button id="playAgainBtn" class="btn-primary">Play Again</button>
  </div>

  <div id="billboard" class="glass panel">
    <h2 class="title">Billboard (Best Scores)</h2>
    <p class="muted">Stored locally in this browser.</p>
    <table>
      <thead><tr><th>#</th><th>Name</th><th>Wrong</th><th>Total Time</th><th>Coins</th><th>Date</th></tr></thead>
      <tbody id="billboardBody"></tbody>
    </table>
  </div>
</div>

<script>
(function(){
  "use strict";

  function key(r,c){ return r + "_" + c; }
  function fmtTime(s){ var m=Math.floor(s/60), sec=Math.round(s%60); return m + ":" + (sec<10 ? "0"+sec : sec); }

  var size = 10;
  var pattern = [], userSel = [];
  var correctCount = 0, wrongCount = 0, totalCoins = 0;
  var recallStart = 0, totalTime = 0;
  var timerInterval = null, gameActive = false;

  // Quiz state
  var quizAnswer = 0, quizTimerInterval = null, quizTimeLeft = 20;

  // Roulette state
  var wheelRotation = 0, spinInProgress = false;

  // Level config
  var levels = {
    0:{shapes:1,min:5,max:10},
    1:{shapes:1,min:10,max:15},
    2:{shapes:1,min:15,max:20},
    3:{shapes:1,min:20,max:25},
    4:{shapes:1,min:25,max:30},
    5:{shapes:1,min:30,max:35},
    6:{shapes:1,min:35,max:40}
  };

  // DOM
  var gridElem = document.getElementById("grid");
  var recallElem = document.getElementById("recallGrid");
  var userGrid = document.getElementById("userGrid");
  var answerGrid = document.getElementById("answerGrid");
  var timerElem = document.getElementById("timer");
  var scoreBoard = document.getElementById("scoreBoard");
  var startBtn = document.getElementById("startBtn");
  var submitBtn = document.getElementById("submitBtn");
  var returnBtn = document.getElementById("returnBtn");
  var resultsDiv = document.getElementById("results");
  var finishDiv = document.getElementById("finish");
  var nextBtn = document.getElementById("nextBtn");
  var playAgainBtn = document.getElementById("playAgainBtn");
  var finalTimeText = document.getElementById("finalTimeText");
  var levelSelect = document.getElementById("level");
  var levelLock = document.getElementById("levelLock");
  var playerNameInput = document.getElementById("playerName");
  var billboardBody = document.getElementById("billboardBody");

  var quizDiv = document.getElementById("quiz");
  var quizQ = document.getElementById("quizQ");
  var quizInput = document.getElementById("quizInput");
  var quizBtn = document.getElementById("quizBtn");
  var quizMsg = document.getElementById("quizMsg");
  var quizTimerLabel = document.getElementById("quizTimer");

  var exerciseRecallDiv = document.getElementById("exerciseRecall");
  var exerciseRecallText = document.getElementById("exerciseRecallText");
  var exerciseRecallDoneBtn = document.getElementById("exerciseRecallDoneBtn");

  var rouletteDiv = document.getElementById("roulette");
  var wheel = document.getElementById("wheel");
  var spinBtn = document.getElementById("spinBtn");
  var rouletteResult = document.getElementById("rouletteResult");

  function updateScoreBoard(){
    scoreBoard.innerHTML = "Score: " + correctCount + " / 10 &nbsp;|&nbsp; Wrong: " + wrongCount + " &nbsp;|&nbsp; Coins: " + totalCoins;
  }

  function lsLoad(){ try{ return JSON.parse(localStorage.getItem("memoryGridBillboardV2")||"[]"); }catch(e){ return []; } }
  function lsSave(x){ localStorage.setItem("memoryGridBillboardV2", JSON.stringify(x)); }
  function renderBillboard(){
    var entries = lsLoad().map(function(e){ return {name:e.name, wrong:+e.wrong, time:+e.time, coins:+e.coins, date:e.date}; })
      .sort(function(a,b){ return (a.wrong-b.wrong) || (a.time-b.time); }).slice(0,10);
    billboardBody.innerHTML = "";
    for(var i=0;i<entries.length;i++){
      var e = entries[i];
      var tr = document.createElement("tr");
      var date = new Date(e.date || Date.now()).toLocaleDateString();
      tr.innerHTML = "<td>"+(i+1)+"</td><td>"+(e.name||"")+"</td><td>"+e.wrong+"</td><td>"+fmtTime(e.time)+"</td><td>"+e.coins+"</td><td>"+date+"</td>";
      billboardBody.appendChild(tr);
    }
  }
  function saveScore(name, wrong, time, coins){
    var arr = lsLoad();
    arr.push({name:name, wrong:wrong, time:time, coins:coins, date:new Date().toISOString()});
    lsSave(arr);
    renderBillboard();
  }

  function blockedWithNeighbors(cells){
    var dirs = [{r:1,c:0},{r:-1,c:0},{r:0,c:1},{r:0,c:-1}];
    var set = new Set();
    for(var i=0;i<cells.length;i++){
      var p = cells[i];
      set.add(key(p.r,p.c));
      for(var d=0;d<dirs.length;d++){
        var nr=p.r+dirs[d].r, nc=p.c+dirs[d].c;
        if(nr>=0&&nr<size&&nc>=0&&nc<size) set.add(key(nr,nc));
      }
    }
    return set;
  }

  // Center-biased connected shape
  function generateConnectedShape(minTiles, maxTiles, blocked){
    var total = Math.floor(Math.random()*(maxTiles-minTiles+1)) + minTiles;
    var dirs = [{r:1,c:0},{r:-1,c:0},{r:0,c:1},{r:0,c:-1}];
    var centerR = Math.floor(size/2), centerC = Math.floor(size/2);
    function d2(r,c){ var dr=r-centerR, dc=c-centerC; return dr*dr + dc*dc; }
    function pickSeed(){
      var rad=3, cands=[];
      for(var r=Math.max(0,centerR-rad); r<=Math.min(size-1,centerR+rad); r++){
        for(var c=Math.max(0,centerC-rad); c<=Math.min(size-1,centerC+rad); c++){
          if(!blocked.has(key(r,c))) cands.push({r:r,c:c});
        }
      }
      if(!cands.length){
        for(var r2=0;r2<size;r2++){ for(var c2=0;c2<size;c2++){ if(!blocked.has(key(r2,c2))) cands.push({r:r2,c:c2}); } }
      }
      cands.sort(function(a,b){ return d2(a.r,a.c) - d2(b.r,b.c); });
      return cands[0];
    }
    function pickWeighted(cands){
      var weights = []; var sum=0;
      for(var i=0;i<cands.length;i++){ var w=1/(1+d2(cands[i].r,cands[i].c)); weights.push(w); sum+=w; }
      var r = Math.random()*sum;
      for(var i2=0;i2<cands.length;i2++){ r -= weights[i2]; if(r<=0) return cands[i2]; }
      return cands[cands.length-1];
    }
    var attempts=0;
    while(attempts<200){
      attempts++;
      var shape=[]; var seed=pickSeed(); if(!seed) break; shape.push(seed);
      function inShape(rr,cc){ for(var i=0;i<shape.length;i++){ if(shape[i].r===rr&&shape[i].c===cc) return true; } return false; }
      while(shape.length<total){
        var cands=[];
        for(var s=0;s<shape.length;s++){
          var p=shape[s];
          for(var d=0; d<dirs.length; d++){
            var nr=p.r+dirs[d].r, nc=p.c+dirs[d].c;
            if(nr>=0&&nr<size&&nc>=0&&nc<size && !inShape(nr,nc) && !blocked.has(key(nr,nc))){
              cands.push({r:nr,c:nc});
            }
          }
        }
        if(!cands.length) break;
        shape.push(pickWeighted(cands));
      }
      if(shape.length>=Math.min(total,3)) return shape;
    }
    return [];
  }

  function buildGrid(elem, fillPattern){
    elem.innerHTML = "";
    for(var r=0;r<size;r++){
      for(var c=0;c<size;c++){
        var div=document.createElement("div"); div.className="cell white";
        if(fillPattern){
          for(var i=0;i<pattern.length;i++){ if(pattern[i].r===r && pattern[i].c===c){ div.classList.replace("white","blue"); break; } }
        }
        elem.appendChild(div);
      }
    }
  }

  function buildRecallGrid(){
    recallElem.innerHTML=""; userSel=[];
    for(var r=0;r<size;r++){
      for(var c=0;c<size;c++){
        (function(rr,cc){
          var div=document.createElement("div"); div.className="cell white";
          div.addEventListener("click", function(){
            var k=key(rr,cc);
            if(div.classList.contains("green")){
              div.classList.replace("green","white");
              var next=[]; for(var i=0;i<userSel.length;i++){ if(userSel[i]!==k) next.push(userSel[i]); } userSel=next;
            }else{
              div.classList.replace("white","green"); userSel.push(k);
            }
          });
          recallElem.appendChild(div);
        })(r,c);
      }
    }
  }

  function buildResultGrid(elem, coords, color){
    elem.innerHTML="";
    for(var r=0;r<size;r++){
      for(var c=0;c<size;c++){
        var found=false;
        for(var i=0;i<coords.length;i++){ if(coords[i].r===r&&coords[i].c===c){ found=true; break; } }
        var div=document.createElement("div"); div.classList.add("cell"); div.classList.add(found?color:"white");
        elem.appendChild(div);
      }
    }
  }

  function resetToStart(fullReset){
    if(fullReset===undefined) fullReset=true;
    if(timerInterval){ clearInterval(timerInterval); timerInterval=null; }
    if(quizTimerInterval){ clearInterval(quizTimerInterval); quizTimerInterval=null; }
    timerElem.textContent="";
    gridElem.style.display="none"; recallElem.style.display="none"; resultsDiv.style.display="none"; finishDiv.style.display="none"; quizDiv.style.display="none";
    submitBtn.style.display="none"; returnBtn.style.display="none"; startBtn.style.display="inline-block";
    gameActive=false; levelSelect.disabled=false; levelLock.style.display="none";
    if(fullReset){ correctCount=0; wrongCount=0; totalCoins=0; totalTime=0; updateScoreBoard(); }
  }

  function startRound(){
    gameActive=true; levelSelect.disabled=true; levelLock.style.display="inline";
    pattern=[];
    var cfg=levels[parseInt(levelSelect.value,10)];
    var blocked=new Set();
    for(var s=0;s<cfg.shapes;s++){
      var shape=generateConnectedShape(cfg.min,cfg.max,blocked);
      pattern=pattern.concat(shape);
      var extra=blockedWithNeighbors(shape);
      extra.forEach(function(k){ blocked.add(k); });
    }
    buildGrid(gridElem,true);
    gridElem.style.display="grid";
    submitBtn.style.display="none";
    returnBtn.style.display="inline-block";

    var t=30; timerElem.textContent="Time left: "+t+"s";
    if(timerInterval) clearInterval(timerInterval);
    timerInterval=setInterval(function(){
      t--; timerElem.textContent="Time left: "+t+"s";
      if(t<=0){
        clearInterval(timerInterval); timerInterval=null; timerElem.textContent="";
        gridElem.style.display="none"; startQuiz();
      }
    },1000);
  }

  function stopQuizTimer(){ if(quizTimerInterval){ clearInterval(quizTimerInterval); quizTimerInterval=null; } }
  function startQuiz(){
    stopQuizTimer(); quizTimeLeft=20;
    quizTimerLabel.textContent="Quiz time left: "+quizTimeLeft+"s";

    // 2-digit +/- 2-digit only
    var a = Math.floor(Math.random()*90)+10;
    var b = Math.floor(Math.random()*90)+10;
    var useAdd = Math.random() < 0.5;
    var sym, qA, qB;

    if (useAdd){
      sym = "+";
      qA = a; qB = b;
      quizAnswer = a + b;
    } else {
      if (b > a){ var t=a; a=b; b=t; }
      sym = "-";
      qA = a; qB = b;
      quizAnswer = a - b;
    }

    quizQ.textContent = "What is " + qA + " " + sym + " " + qB + "?";
    quizInput.value=""; quizMsg.textContent="";
    quizDiv.style.display="block"; quizInput.disabled=false; quizBtn.disabled=false; quizInput.focus();

    quizTimerInterval=setInterval(function(){
      quizTimeLeft--; quizTimerLabel.textContent="Quiz time left: "+quizTimeLeft+"s";
      if(quizTimeLeft<=0){ stopQuizTimer(); quizMsg.textContent="Time's up — try another one."; setTimeout(startQuiz,500); }
    },1000);
  }
  function proceedToRecall(){ stopQuizTimer(); quizDiv.style.display='none'; recallElem.style.display='grid'; submitBtn.style.display='inline-block'; buildRecallGrid(); recallStart=Date.now(); }
  function checkQuiz(){ var v=parseInt((quizInput.value||'').trim(),10); if(!isFinite(v)){ quizMsg.textContent='Please enter a number.'; return; } if(v===quizAnswer) proceedToRecall(); else { quizMsg.textContent='Incorrect — try another one.'; setTimeout(startQuiz,500);} }

  function spinRoulette(){
    if(spinInProgress) return; spinInProgress=true; spinBtn.disabled=true; rouletteResult.textContent="Spinning...";
    wheel.style.transition="transform 5.5s cubic-bezier(0.06,0.9,0.08,1)";
    var target=Math.random()*360; var spins=5+Math.floor(Math.random()*4); var finalRotation=wheelRotation+(spins*360)+target-(wheelRotation%360);
    wheel.style.transform="rotate("+finalRotation+"deg)"; wheelRotation=finalRotation;
    var onEnd=function(){ wheel.removeEventListener("transitionend",onEnd); var a=((wheelRotation%360)+360)%360; var base=((90 - a + 360)%360);
      var prize=0; if(base>=90&&base<180) prize=1; else if(base>=180&&base<270) prize=2; else if(base>=270&&base<360) prize=5;
      rouletteResult.textContent="You earned "+prize+" coin"+(prize===1?"":"s")+"!"; totalCoins+=prize; updateScoreBoard(); spinInProgress=false; nextBtn.style.display="inline-block"; };
    wheel.addEventListener("transitionend", onEnd, {once:true});
  }

  function onSubmit(){
    var correct = (function(){ if(userSel.length!==pattern.length) return false; for(var i=0;i<pattern.length;i++){ if(userSel.indexOf(key(pattern[i].r,pattern[i].c))===-1) return false; } return true; })();
    recallElem.style.display="none"; submitBtn.style.display="none"; returnBtn.style.display="none"; resultsDiv.style.display="block";
    var selObjs=[]; for(var i=0;i<userSel.length;i++){ var parts=userSel[i].split("_"); selObjs.push({r:+parts[0], c:+parts[1]}); }
    buildResultGrid(userGrid, selObjs, "green"); buildResultGrid(answerGrid, pattern, "blue");
    if(correct){ correctCount++; totalTime += (Date.now()-recallStart)/1000; updateScoreBoard(); exerciseRecallDiv.style.display="none"; nextBtn.style.display="none"; rouletteDiv.style.display="block"; spinBtn.disabled=false; rouletteResult.textContent="Tap Spin to earn coins!"; }
    else { wrongCount++; updateScoreBoard(); rouletteDiv.style.display="none"; nextBtn.style.display="none"; var opts=["Do 10 squats.","Hold a plank for 20 seconds.","Do 15 jumping jacks.","Do 10 lunges (each leg).","Do a wall sit for 20 seconds."]; var msg=opts[Math.floor(Math.random()*opts.length)]; exerciseRecallText.innerHTML="<span class=\"pill bad\">Break</span> "+msg+" Then click I am done."; exerciseRecallDiv.style.display="block"; }
  }

  function maybeFinish(){ if(correctCount>=10){ resultsDiv.style.display="none"; finishDiv.style.display="block"; finalTimeText.textContent="Your final score -> Wrong: "+wrongCount+" | Total time: "+fmtTime(totalTime)+" | Coins: "+totalCoins; var name=(playerNameInput.value||"Player").slice(0,24); saveScore(name, wrongCount, totalTime, totalCoins); gameActive=false; levelSelect.disabled=false; levelLock.style.display="none"; } }

  function nextRound(){ rouletteDiv.style.display="none"; exerciseRecallDiv.style.display="none"; spinBtn.disabled=false; rouletteResult.textContent=""; resultsDiv.style.display="none"; if(correctCount>=10){ maybeFinish(); } else { startRound(); } }

  function bindHandlers(){
    startBtn.addEventListener("click", function(){ startBtn.style.display="none"; nextRound(); });
    submitBtn.addEventListener("click", onSubmit);
    nextBtn.addEventListener("click", nextRound);
    playAgainBtn.addEventListener("click", function(){ resetToStart(true); });
    returnBtn.addEventListener("click", function(){ resetToStart(true); });
    quizBtn.addEventListener("click", checkQuiz);
    quizInput.addEventListener("keydown", function(e){ if(e.key==="Enter"){ checkQuiz(); } });
    exerciseRecallDoneBtn.addEventListener("click", function(){ exerciseRecallDiv.style.display="none"; nextBtn.style.display="inline-block"; });
    spinBtn.addEventListener("click", spinRoulette);
    levelSelect.addEventListener("change", function(e){ if(gameActive){ e.preventDefault(); levelSelect.blur(); }});
    renderBillboard();
  }
  if(document.readyState==="loading"){ document.addEventListener("DOMContentLoaded", bindHandlers); } else { bindHandlers(); }
})();
</script>
</body>
</html>
